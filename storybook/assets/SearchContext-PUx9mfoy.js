import{r as t,n as y,j as l,ab as R,c as I,ac as N}from"./iframe-DRkdG3e7.js";import{l as q}from"./lodash-CwBbdt2Q.js";import{u as T}from"./useAsync-BIYzE4vq.js";import{s as k}from"./api-CMUBJ6LB.js";import{A as F,u as _}from"./useAnalytics-D4adgS3v.js";function P(e){var s=t.useRef();return t.useEffect(function(){s.current=e}),s.current}const m=R("search-context"),Q=()=>{const e=t.useContext(m);if(!e)throw new Error("useSearch must be used within a SearchContextProvider");const s=e.atVersion(1);if(!s)throw new Error("No SearchContext v1 found");return s},M=()=>t.useContext(m)!==void 0,b={term:"",types:[],filters:{},pageLimit:void 0,pageCursor:void 0},O=(e=b)=>{const s=y(k),i=_(),[r,h]=t.useState(e.term),[c,f]=t.useState(e.types),[a,p]=t.useState(e.filters),[v,A]=t.useState(e.pageLimit),[x,n]=t.useState(e.pageCursor),g=P(r),d=P(a),u=t.useRef(null),o=T(async()=>{u.current&&u.current.abort();const C=new AbortController;u.current=C;const S=await s.query({term:r,types:c,filters:a,pageLimit:v,pageCursor:x},{signal:C.signal});return r&&i.captureEvent("search",r,{value:S.numberOfResults}),S},[r,c,a,v,x]),E=!o.loading&&!o.error&&o.value?.nextPageCursor,w=!o.loading&&!o.error&&o.value?.previousPageCursor,L=t.useCallback(()=>{n(o.value?.nextPageCursor)},[o.value?.nextPageCursor]),j=t.useCallback(()=>{n(o.value?.previousPageCursor)},[o.value?.previousPageCursor]);return t.useEffect(()=>()=>{u.current&&u.current.abort()},[]),t.useEffect(()=>{g!==void 0&&r!==g&&n(void 0)},[r,g,n]),t.useEffect(()=>{d!==void 0&&!q.isEqual(a,d)&&n(void 0)},[a,d,n]),{result:o,term:r,setTerm:h,types:c,setTypes:f,filters:a,setFilters:p,pageLimit:v,setPageLimit:A,pageCursor:x,setPageCursor:n,fetchNextPage:E?L:void 0,fetchPreviousPage:w?j:void 0}},V=e=>{const{initialState:s,children:i}=e,r=O(s);return l.jsx(F,{attributes:{searchTypes:r.types.sort().join(",")},children:l.jsx(m.Provider,{value:N({1:r}),children:i})})},z=e=>{const{initialState:s,inheritParentContextIfAvailable:i,children:r}=e,h=M(),c=y(I),f=s??{},a=c.has("search.query.pageLimit")?{pageLimit:c.getNumber("search.query.pageLimit")}:{},p={...b,...f,...a};return h&&i?l.jsx(l.Fragment,{children:r}):l.jsx(V,{initialState:p,children:r})};z.__docgenInfo={description:`@public
Search context provider which gives you access to shared state between search components`,methods:[],displayName:"SearchContextProvider"};export{z as S,P as a,Q as u};
